ARG ORG=ej
FROM ${ORG}/web:base

# Copy files
COPY ./.coveragerc /app/
COPY ./*.py /app/
COPY ./*.rst /app/
COPY ./etc/ /app/etc/
COPY ./docs/ /app/docs
COPY ./locale/ /app/locale/
COPY ./lib/ /app/lib/
COPY ./src/ /app/src/

# Prepare assets
RUN mkdir -p local/logs local/static/ local/media/ local/db/ \
 && inv -e docs \
 && inv -e js \
 && inv -e sass \
 && python manage.py collectstatic --noinput \
 && echo "COLLECTED STATIC ASSETS"

# Default command
CMD ["db", "-m", "gunicorn"]

{% extends 'ej_conversations/base.jinja2' %}
{% set main_class = 'container-1 pad-x0 moderate' %}
{% set body_class = 'body theme-' + conversation.board.palette %}

{% block content %}
    {{ conversation|role('balloon', actions=False) }}
    <h1 class="h2 relative text-accent left">
        {{ _('Comments') }}
        <div class="tooltip">
            <i class="tooltip__icon fas fa-info-circle"></i>
            <div class="tooltip__content">
                {{ _('Here you can moderate the comments and add new ones. Those that have not yet been approved or rejected are in the "Pending" Tab') }}
            </div>
        </div>
    </h1>
    
    {% if comment_saved %}
        <div class="modal__overlay" id="comment-saved">
            <div class="modal__container" >
                <i class="modal__icon--success fas fa-check-circle fa-4x"></i>
                <div class="modal__title">{{_("Comments Saved")}}</div>
                <a class="text-accent bold underline margin-b2" href="{{ conversation.url('cluster:stereotype-votes') }}">Gerenciar personas</a>
                <a class="modal__btn modal__btn--no-fill underline lowercase" onclick="closePopup('comment-saved')">{{_('Close')}}</a>
            </div>
        </div>
    {% endif %}

    <div class="modal__overlay hide" id="comment-erased">
        <div class="modal__container">
            <i class="modal__icon--alert fas fa-times-circle fa-4x"></i>
            <div class="modal__title margin-b2">{{_("Comment excluded")}}</div>
            <a class="modal__btn modal__btn--no-fill underline" onclick="closePopup('comment-erased')">{{_('Close')}}</a>
        </div>
    </div>

    <div class="modal__overlay hide" id="erase-comment-confirm">
        <div class="modal__container">
            <div class="modal__title">{{_("Are you sure about this action?")}}</div>
            <p>{{_("If the comment has votes, they will be lost.")}}</p>
            <div class="modal__buttons">
                <button class="modal__btn modal__btn--red" onclick="eraseFn()">
                    <i class="fas fa-lg fa-times-circle"></i> {{_("Yes, I want to erase the comment")}}
                </button>
                <button class="modal__btn modal__btn--blue" onclick="closePopup('erase-comment-confirm')">
                    <i class="fas fa-lg fa-minus-circle"></i> {{_("No, I want get back")}}
                </button>
            </div>
        </div>
    </div>

    {{ tabs({_('Pending'): '#moderate-pending',
            _('Approved'): '#moderate-approved',
            _('Rejected'): '#moderate-rejected',
            _('Add'): '#moderate-add'}) }}
    {{ show_comments(pending, 'pending') }}
    {{ show_comments(approved, 'approved') }}
    {{ show_comments(rejected, 'rejected') }}

    <script>
        const path = document.location.href.split('/');
        if(path[path.length - 2] == 'new') {
            const tab = document.querySelector(".tabs :last-child");
            tab.click();
        }
    </script>

    
    {% include 'ej_conversations/includes/tab-moderate-add-comments.jinja2' %}

{% endblock %}

{% macro show_comments(comments, id) %}
    {% include 'ej_conversations/includes/tab-moderate-show-comments.jinja2' %}
{% endmacro %}

{% macro reject_button(comment) %}
    <span class="text-negative"><button class="is-clear" name="reject_id" value="{{ comment.id }}">
        <i class="fa fa-times"></i>{{ _('Reject') }}
    </button></span>
{% endmacro %}


{% macro approve_button(comment) %}
    <span class="text-positive"><button class="is-clear" name="approve_id" value="{{ comment.id }}">
        <i class="fa fa-check"></i>{{ _('Approve') }}
    </button></span>
{% endmacro %}
{% extends 'base.jinja2' %}
{% set main_class = 'pad-x0' %}
{% block menu %}{% include 'ej_boards/includes/menu-board.jinja2' %}{% endblock %}


{% block content %}
    <form method="POST" class="width-full">
        {{ csrf_input }}
        {% block balloon %}
            {% with create_mode=true %}
                {% include 'ej_conversations/includes/editable-conversation-balloon.jinja2' %}
            {% endwith %}
        {% endblock %}

        {% block form_content %}
            {{ form.media }}
            <div class="conversation-form content-grid">
                <div>
                    {# CONVERSATION FORM #}
                    <h3 class="conversation-form__h3">{{ _('Details') }}</h3>
                    <p class="helptext">
                    {% trans %}The following fields composes the conversation structure. They will help you to customize the participation process.Some fields are optional and can be edited later.{% endtrans %}</p>
                    <div>
                        {{ form.non_field_errors() }}
                        <h4 class="conversation-form__h4">{{_("Conversation about")}}</h4>
                        {{ form.title.errors }}
                        <label>{{ form.title.label }}{{ form.title }}</label>
                    </div>
                    <legend>{{ form.title.help_text }}</legend>

                    <h4 class="conversation-form__h4">{{_("Anonymous participation")}}</h4>
                    <div class="block">
                        <div class="flex">
                            <label for="">{{form.anonymous_votes_limit.label}}</label>
                            <span class="helptext">&nbsp;({{_("optional")}})</span>
                        </div>
                        {{form.anonymous_votes_limit}}
                        <legend>{{form.anonymous_votes_limit.help_text}}</legend>
                    </div>

                    <h4>{{_("Conversation duration")}}</h4>
                    <div class="conversation-form__duration">
                        <div>{{form.start_date}}</div>
                        <div>{{form.end_date}}</div>
                    </div>

                    <h4>{{_("Conversation welcome message")}}</h4>
                    <div class="conversation-form__duration">
                        <div>{{form.welcome_message}}</div>
                    </div>

                    {% block initial_comments %}
                        {# ADD COMMENTS #}
                        <h4>{{_("Initial comments")}}</h4>
                        <p class="helptext">
                            {{ _('Add as many comments as you like (including none).') }}{{ ' ' }}
                            {{ _('Remember to give a minimum context and something for other users to explore.') }}{{ ' ' }}
                            {{ _('You can add as many comments as you want later.') }}
                        </p>
                        <input type="hidden" name="comments_count" value="3">
                        <div id="comment-list">
                            {% for i in range(1, 4) %}
                                <label>
                                    {% trans %}Comment {{ i }}{% endtrans %}
                                    <textarea name="comment-{{ i }}"
                                            placeholder="{{ _('Type your comment here') }} #{{ i }}"></textarea>
                                </label>
                            {% endfor %}
                        </div>

                        <a class="uppercase semi-bold" id="add-more-comments" tabindex="0">
                            <i class="fa fa-plus text-accent"></i> <span class="text-accent">{{ _('Add more comments') }}</span>
                        </a>
                    {% endblock %}

                    {% block conversation_form_button %}
                        <div class="margin-xauto margin-y3">
                            <input class="is-primary button" type="submit" value="{{ _('Create conversation') }}">
                        </div>
                    {% endblock %}
                </div>
            </div>
        {% endblock %}
    </form>
{% endblock %}


{% block javascript %}
    {{ super() }}
    <!--suppress SpellCheckingInspection -->
    <script>
        window.addEventListener('load', function () {
            $('#add-more-comments')
                .on('click keypress', function (ev) {
                    // keycodes: 13 = return; 32 = space
                    if (ev.type === "keypress" && (![13, 32].includes(ev.keyCode))) return;
                    var $input = $('input[name="comments_count"]'),
                        index = parseInt($input.val(), 10) + 1,
                        template = (
                            '<label>' +
                            `{{ gettext(" Comment ") }} ${index}` +
                            '<textarea name="comment-%i%" placeholder="{{ _('Type your comment here') }} #%i%"></textarea>' +
                            '</label>');
                    $input.val(index);
                    $('#comment-list').append(template.replace(/%i%/g, index));
                });
        });
    </script>
{% endblock %}

